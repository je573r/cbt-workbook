<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CBT Workbook - Your personal mental health companion.">
  <meta name="keywords" content="CBT, Cognitive Behavioral Therapy, Mental Health, Workbook">
  <meta name="author" content="Team Jesters">
  <meta name="htmx-config" content='{"inlineScriptNonce":"{{ nonce }}"}'>
  <!-- og tags with same image for all -->
  <meta property="og:title" content="CBT Workbook">
  <meta property="og:description" content="CBT Workbook - Your personal mental health companion.">
  <meta property="og:image" content="/public/imgs/og-image.png">
  <meta property="og:url" content="https://cbtworkbook.jesters.tech">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="CBT Workbook">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="en_GB">
  <meta property="og:locale:alternate" content="en_IN">
  <link rel="shortcut icon" href="/public/imgs/favicon.ico" type="image/x-icon">
  <title>
    {% block title %}
    CBT Workbook
    {% endblock %}
  </title>
  <link rel="stylesheet" href="/public/css/output.css">
  <script src="/public/scripts/htmx.min.js" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" defer></script>
  <script src="/public/scripts/alpine.min.js" integrity="sha384-9Ax3MmS9AClxJyd5/zafcXXjxmwFhZCdsT6HJoJjarvCaAkJlk5QDzjLJm+Wdx5F" defer></script>
</head>
<body class="bg-radial bg-purple-950 to-black text-white relative">
{% block afterbody %}
{% endblock %}
  {% block header %}
  <header>
    <nav class="flex justify-between items-center p-6">
      <h1 class="text-2xl font-bold text-white">
        <a href="/" class="gradient-text hover:text-white transition-colors duration-300">CBT Workbook</a>
      </h1>
      <div class="hidden md:flex items-center space-x-4">
        <ul class="flex space-x-4">
          <li>
            <a href="/dashboard"
              class="text-gray-300 hover:text-white relative transition duration-300 after:absolute after:bottom-[-4px] after:left-0 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full">Dashboard</a>
          </li>
          <li>
            <a href="/gratitude/board"
              class="text-gray-300 hover:text-white relative transition duration-300 after:absolute after:bottom-[-4px] after:left-0 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full">Gratitude Board</a>
          </li>
          <li>
            <a href="/about"
              class="text-gray-300 hover:text-white relative transition duration-300 after:absolute after:bottom-[-4px] after:left-0 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full">About</a>
          </li>
          {% if user %}
          <li class="relative group" tabindex="0">
            <button
              class="text-gray-300 hover:text-white relative transition duration-300 flex items-center focus:outline-none"
              aria-haspopup="true" aria-expanded="false" aria-controls="my-area-dropdown"
            >
              My Area
              <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div
              id="my-area-dropdown"
              class="absolute left-0 mt-2 w-48 bg-gray-900 border border-gray-700 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 z-50"
              role="menu"
            >
              <a href="/bdi/history" role="menuitem"
                class="block pl-8 pr-4 pt-4 pb-4 text-gray-200 relative transition duration-300 after:absolute after:bottom-1 after:left-8 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-[45%] hover:text-white focus:text-white rounded-t-lg"
                tabindex="0"
              >BDI History</a>
              <a href="/mood-tracker" role="menuitem"
                class="block pl-8 pr-4 pt-4 pb-4 text-gray-200 relative transition duration-300 after:absolute after:bottom-1 after:left-8 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-[50%] hover:text-white focus:text-white"
                tabindex="0"
              >Mood Tracker</a>
              <a href="/thought-record" role="menuitem"
                class="block pl-8 pr-4 pt-4 pb-4 text-gray-200 relative transition duration-300 after:absolute after:bottom-1 after:left-8 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-[65%] hover:text-white focus:text-white"
                tabindex="0"
              >Thought Records</a>
              <a href="/gratitude" role="menuitem"
                class="block pl-8 pr-4 pt-4 pb-4 mb-2 text-gray-200 relative transition duration-300 after:absolute after:bottom-1 after:left-8 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-[38%] hover:text-white focus:text-white rounded-b-lg"
                tabindex="0"
              >Gratitude</a>
            </div>
          </li>
          {% endif %}
        </ul>
        {% if user %}
        <div class="relative group ml-4">
          <button
            class="flex items-center text-purple-300 hover:text-white focus:outline-none"
            aria-haspopup="true" aria-expanded="false" aria-controls="user-dropdown"
          >
            Hello, {{ user.username }}
            <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div
            id="user-dropdown"
            class="absolute right-0 mt-2 w-32 bg-gray-900 border border-gray-700 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 z-50"
          >
            <a href="/logout" class="block px-4 py-2 text-gray-200 hover:bg-purple-700 rounded-lg">Logout</a>
          </div>
        </div>
        {% else %}
        <div class="flex items-center space-x-4">
          <a href="/login"
            class="text-gray-300 hover:text-white relative transition duration-300 after:absolute after:bottom-[-4px] after:left-0 after:h-[2px] after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full">Login</a>
          <a href="/register"
            class="relative px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg overflow-hidden transition-all duration-300 hover:from-blue-700 hover:to-purple-700 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/30">
            <span class="relative z-10">Register</span>
          </a>
        </div>
        {% endif %}
      </div>
      <button class="md:hidden text-gray-300 focus:outline-none transform transition-transform duration-300" id="menu-toggle">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
        </svg>
      </button>
    </nav>
    <div class="md:hidden text-gray-300 space-y-4 p-4 hidden opacity-0 transform -translate-y-2 transition-all duration-300" id="mobile-menu">
      {% if user %}
      <a href="/dashboard" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Dashboard</a>
      <a href="/gratitude/board" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Gratitude Board</a>
      <a href="/about" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">About</a>
      <a href="/bdi/history" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">BDI Quiz History</a>
      <a href="/mood-tracker" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Mood Tracker</a>
      <a href="/thought-record" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Thought Records</a>
      <a href="/gratitude" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Gratitude</a>
      <a href="/logout" class="block w-full text-center px-4 py-2 border border-purple-500 text-purple-400 font-semibold rounded-lg hover:bg-purple-500 hover:text-white transition-all duration-300">Logout</a>
      {% else %}
      <a href="/dashboard" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Dashboard</a>
      <a href="/gratitude/board" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Gratitude Board</a>
      <a href="/about" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">About</a>
      <a href="/login" class="block hover:text-white hover:translate-x-2 transition-all duration-300 pl-2 border-l-2 border-transparent hover:border-purple-500">Login</a>
      <a href="/register" class="block w-full text-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/30">Register</a>
      {% endif %}
    </div>
  </header>
  {% endblock %}

  <!-- Flash Messages -->
  {% if flashes and flashes.length > 0 %}
      {% for flash in flashes %}
          <!-- FlashMessage Component -->
          <div
          x-data="flashMessage({ message: '{{ flash.message }}', type: '{{ flash.type }}', duration: 7500 })"
          x-init="init()"
          x-show="visible"
          x-transition:enter="transition ease-out duration-500"
          x-transition:enter-start="opacity-0 transform scale-90"
          x-transition:enter-end="opacity-100 transform scale-100"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100 transform scale-100"
          x-transition:leave-end="opacity-0 transform scale-90"
          :class="typeClasses[type] || typeClasses.info"
          class="max-w-md w-full mx-auto p-4 rounded shadow-lg mb-4 relative"
          >
          <div class="pr-8">
            <span x-text="message"></span>
          </div>
          <button
            @click="dismiss()"
            class="absolute top-2 right-2 text-white hover:text-gray-200"
            aria-label="Dismiss"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
          </div>
      {% endfor %} 
  {% endif %}

  {% block main %}
  <main></main>
  {% endblock %}

  {% block footer %}
  <footer>
    <div class="text-gray-300 text-center p-4">
      <p>&copy; 2025 CBT Workbook. All rights reserved.</p>
      <p>Made with <span class="text-purple-500">♡</span> by Team Jesters</p>
    </div>
  </footer>
  {% endblock %}


  <script nonce="{{ nonce }}">
    document.getElementById('menu-toggle').addEventListener('click', function () {
      const menu = document.getElementById('mobile-menu');
      const button = this;

      // Toggle visibility first
      menu.classList.toggle('hidden');

      // After a slight delay, toggle the animation classes
      setTimeout(() => {
        if (!menu.classList.contains('hidden')) {
          menu.classList.remove('opacity-0', '-translate-y-2');
          button.classList.add('rotate-90');
        } else {
          menu.classList.add('opacity-0', '-translate-y-2');
          button.classList.remove('rotate-90');
        }
      }, 10);
    });

    function flashMessage({ message, type, duration = 5000 }) {
    return {
      visible: true,
      message,
      type,
      typeClasses: {
        success: 'bg-green-500 text-white',
        error:   'bg-red-500 text-white',
        warning: 'bg-yellow-400 text-black',
        info:    'bg-blue-500 text-white'
      },
      init() {
        // auto‐dismiss after duration
        setTimeout(() => this.dismiss(), duration)
      },
      dismiss() {
        this.visible = false
      }
    }
  }
  </script>  

  {% block scripts %}
  {% endblock %}
</body>

</html>
